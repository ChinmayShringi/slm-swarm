version: "3.8"

# Homogeneous swarm: 18 workers (all Qwen 2.5 7B) with temperature variation

services:
  worker_1:
    image: ollama/ollama:latest
    container_name: homo18_worker_1
    volumes:
      - ./models/qwen:/root/.ollama
    environment:
      - OLLAMA_HOST=0.0.0.0
    networks:
      - slm_net

  worker_2:
    image: ollama/ollama:latest
    container_name: homo18_worker_2
    volumes:
      - ./models/qwen:/root/.ollama
    environment:
      - OLLAMA_HOST=0.0.0.0
    networks:
      - slm_net

  worker_3:
    image: ollama/ollama:latest
    container_name: homo18_worker_3
    volumes:
      - ./models/qwen:/root/.ollama
    environment:
      - OLLAMA_HOST=0.0.0.0
    networks:
      - slm_net

  worker_4:
    image: ollama/ollama:latest
    container_name: homo18_worker_4
    volumes:
      - ./models/qwen:/root/.ollama
    environment:
      - OLLAMA_HOST=0.0.0.0
    networks:
      - slm_net

  worker_5:
    image: ollama/ollama:latest
    container_name: homo18_worker_5
    volumes:
      - ./models/qwen:/root/.ollama
    environment:
      - OLLAMA_HOST=0.0.0.0
    networks:
      - slm_net

  worker_6:
    image: ollama/ollama:latest
    container_name: homo18_worker_6
    volumes:
      - ./models/qwen:/root/.ollama
    environment:
      - OLLAMA_HOST=0.0.0.0
    networks:
      - slm_net

  worker_7:
    image: ollama/ollama:latest
    container_name: homo18_worker_7
    volumes:
      - ./models/qwen:/root/.ollama
    environment:
      - OLLAMA_HOST=0.0.0.0
    networks:
      - slm_net

  worker_8:
    image: ollama/ollama:latest
    container_name: homo18_worker_8
    volumes:
      - ./models/qwen:/root/.ollama
    environment:
      - OLLAMA_HOST=0.0.0.0
    networks:
      - slm_net

  worker_9:
    image: ollama/ollama:latest
    container_name: homo18_worker_9
    volumes:
      - ./models/qwen:/root/.ollama
    environment:
      - OLLAMA_HOST=0.0.0.0
    networks:
      - slm_net

  worker_10:
    image: ollama/ollama:latest
    container_name: homo18_worker_10
    volumes:
      - ./models/qwen:/root/.ollama
    environment:
      - OLLAMA_HOST=0.0.0.0
    networks:
      - slm_net

  worker_11:
    image: ollama/ollama:latest
    container_name: homo18_worker_11
    volumes:
      - ./models/qwen:/root/.ollama
    environment:
      - OLLAMA_HOST=0.0.0.0
    networks:
      - slm_net

  worker_12:
    image: ollama/ollama:latest
    container_name: homo18_worker_12
    volumes:
      - ./models/qwen:/root/.ollama
    environment:
      - OLLAMA_HOST=0.0.0.0
    networks:
      - slm_net

  worker_13:
    image: ollama/ollama:latest
    container_name: homo18_worker_13
    volumes:
      - ./models/qwen:/root/.ollama
    environment:
      - OLLAMA_HOST=0.0.0.0
    networks:
      - slm_net

  worker_14:
    image: ollama/ollama:latest
    container_name: homo18_worker_14
    volumes:
      - ./models/qwen:/root/.ollama
    environment:
      - OLLAMA_HOST=0.0.0.0
    networks:
      - slm_net

  worker_15:
    image: ollama/ollama:latest
    container_name: homo18_worker_15
    volumes:
      - ./models/qwen:/root/.ollama
    environment:
      - OLLAMA_HOST=0.0.0.0
    networks:
      - slm_net

  worker_16:
    image: ollama/ollama:latest
    container_name: homo18_worker_16
    volumes:
      - ./models/qwen:/root/.ollama
    environment:
      - OLLAMA_HOST=0.0.0.0
    networks:
      - slm_net

  worker_17:
    image: ollama/ollama:latest
    container_name: homo18_worker_17
    volumes:
      - ./models/qwen:/root/.ollama
    environment:
      - OLLAMA_HOST=0.0.0.0
    networks:
      - slm_net

  worker_18:
    image: ollama/ollama:latest
    container_name: homo18_worker_18
    volumes:
      - ./models/qwen:/root/.ollama
    environment:
      - OLLAMA_HOST=0.0.0.0
    networks:
      - slm_net

  coordinator:
    build: ./coordinator
    container_name: homo18_coordinator
    environment:
      - WORKERS=["http://worker_1:11434","http://worker_2:11434","http://worker_3:11434","http://worker_4:11434","http://worker_5:11434","http://worker_6:11434","http://worker_7:11434","http://worker_8:11434","http://worker_9:11434","http://worker_10:11434","http://worker_11:11434","http://worker_12:11434","http://worker_13:11434","http://worker_14:11434","http://worker_15:11434","http://worker_16:11434","http://worker_17:11434","http://worker_18:11434"]
      - MODELS=["qwen2.5:7b-instruct","qwen2.5:7b-instruct","qwen2.5:7b-instruct","qwen2.5:7b-instruct","qwen2.5:7b-instruct","qwen2.5:7b-instruct","qwen2.5:7b-instruct","qwen2.5:7b-instruct","qwen2.5:7b-instruct","qwen2.5:7b-instruct","qwen2.5:7b-instruct","qwen2.5:7b-instruct","qwen2.5:7b-instruct","qwen2.5:7b-instruct","qwen2.5:7b-instruct","qwen2.5:7b-instruct","qwen2.5:7b-instruct","qwen2.5:7b-instruct"]
      - WORKER_TEMPERATURES=[0.1,0.15,0.2,0.25,0.3,0.35,0.4,0.45,0.5,0.55,0.6,0.65,0.7,0.75,0.8,0.85,0.9,0.95]
      - CONSENSUS_METHOD=cosine
      - CONSENSUS_THRESHOLD=0.3
      - SWARM_TYPE=homogeneous
      - BIGMODEL_URL=${BIGMODEL_URL:-}
      - BIGMODEL_MODEL=${BIGMODEL_MODEL:-}
      - BIGMODEL_TYPE=${BIGMODEL_TYPE:-openai}
      - BIGMODEL_API_KEY=${BIGMODEL_API_KEY:-}
    depends_on:
      - worker_1
      - worker_2
      - worker_3
      - worker_4
      - worker_5
      - worker_6
      - worker_7
      - worker_8
      - worker_9
      - worker_10
      - worker_11
      - worker_12
      - worker_13
      - worker_14
      - worker_15
      - worker_16
      - worker_17
      - worker_18
    ports:
      - "8118:8000"
    networks:
      - slm_net

  evaluator:
    build: ./evaluator
    container_name: homo18_evaluator
    environment:
      - COORDINATOR_URL=http://coordinator:8000
      - DATASET_PATH=/app/dataset/samsum.jsonl
      - RESULTS_DIR=/app/results
      - ENABLE_BIG_MODEL=false
    volumes:
      - ./dataset:/app/dataset
      - ./results:/app/results
    depends_on:
      - coordinator
    networks:
      - slm_net
    profiles:
      - evaluation

networks:
  slm_net:
    driver: bridge

